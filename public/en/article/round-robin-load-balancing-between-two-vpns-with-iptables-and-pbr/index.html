<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
	
	
	<link rel="canonical" href="https://www.ScienceChronicle.org/en/article/round-robin-load-balancing-between-two-vpns-with-iptables-and-pbr/" />
	

	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8917464542382293"
     crossorigin="anonymous">
</script>

	<link rel="icon" href="/favicon.png">

  <title>
  Round-robin load-balancing between two VPNs with iptables and policy-based routing - ScienceChronicle
  </title>
  <meta name="description" content="The post describes a way to create round-robin balancing between two VPNs using Linux iptables and policy based routing. " /><meta name="generator" content="Hugo 0.105.0"><link
    rel="stylesheet"
    href="https://www.ScienceChronicle.org/css/styles.min.28f7df8c9d6eb4fea348f73e7323460d6a3344fa0625a85ced2a91f07eeb2034.css"
    integrity="sha256-KPffjJ1utP6jSPc+cyNGDWozRPoGJahc7SqR8H7rIDQ="
  />
  
  

  <meta property="og:title" content="Round-robin load-balancing between two VPNs with iptables and policy-based routing" />
<meta property="og:description" content="The post describes a way to create round-robin balancing between two VPNs using Linux iptables and policy based routing. " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ScienceChronicle.org/en/article/round-robin-load-balancing-between-two-vpns-with-iptables-and-pbr/" /><meta property="article:section" content="article" />
<meta property="article:published_time" content="2024-06-09T11:52:37+00:00" />
<meta property="article:modified_time" content="2024-06-09T11:52:37+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Round-robin load-balancing between two VPNs with iptables and policy-based routing"/>
<meta name="twitter:description" content="The post describes a way to create round-robin balancing between two VPNs using Linux iptables and policy based routing. "/>

  <meta itemprop="name" content="Round-robin load-balancing between two VPNs with iptables and policy-based routing">
<meta itemprop="description" content="The post describes a way to create round-robin balancing between two VPNs using Linux iptables and policy based routing. "><meta itemprop="datePublished" content="2024-06-09T11:52:37+00:00" />
<meta itemprop="dateModified" content="2024-06-09T11:52:37+00:00" />
<meta itemprop="wordCount" content="1190">
<meta itemprop="keywords" content="" />

  
  <meta name="lang" content="en" />
  
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="https://www.ScienceChronicle.org/en/" class="capitalize font-extrabold text-2xl">
    
    <img src="/logo8.png" alt="ScienceChronicle" class="h-8 max-w-full" />
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">

    
    <li><a href="/en/news">News</a></li>
    
    <li><a href="/en/article">Articles</a></li>
    
    <li><a href="/en/quiz">Quizes</a></li>
    
    <li><a href="/en/categories">Categories</a></li>
    
    <li><a href="/en/tags">Tags</a></li>
    

    
    
    <li class="relative cursor-pointer">
      <span class="language-switcher flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
          stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="9" />
          <line x1="3.6" y1="9" x2="20.4" y2="9" />
          <line x1="3.6" y1="15" x2="20.4" y2="15" />
          <path d="M11.5 3a17 17 0 0 0 0 18" />
          <path d="M12.5 3a17 17 0 0 1 0 18" />
        </svg>
        <a>Language</a>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
          viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round"
          stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M18 15l-6 -6l-6 6h12" transform="rotate(180 12 12)" />
        </svg>
      </span>
      <div
        class="language-dropdown absolute top-full mt-2 left-0 flex-col gap-2 bg-gray-100 dark:bg-gray-900 dark:text-white z-10 hidden">
        
        
        
        
        <a class="px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700" href="/de" lang="de">Deutsch</a>
        
        
        
        <a class="px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700" href="/ru" lang="ru">Русский</a>
        
        
      </div>
    </li>
    
    

    
    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>
    

    
  </ul>
</header>
<main class="flex-1">
  
  

  
  <div class="relative max-w-5xl mx-auto px-4">
    <img src="/article/round-robin-load-balancing-between-two-vpns-with-iptables-and-pbr/thumb.png" class="rounded-lg shadow-sm w-full object-contain" />
    
    <div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">
      
  
    June 9, 2024
  


    </div>
    
  </div>
  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Round-robin load-balancing between two VPNs with iptables and policy-based routing</h1>
    
    <h5 class="text-sm flex items-center flex-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    June 9, 2024
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      6&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      1190&nbsp;words
      
        
      
    </h5>
    

    <details id="TableOfContents" class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc">
    <summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white">
      <span>Table of contents</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <polyline points="6 9 12 15 18 9"></polyline>
     </svg>
    </summary>

    <ul class="mt-2 pb-4">
        

        
        <li>
        <a href="#experiment-1">Experiment 1</a>
        

        
        <ul>
            <li>
        <a href="#vpn-tunnels">VPN tunnels</a>
        

        
        </li><li>
        <a href="#routing">Routing</a>
        

        
        </li><li>
        <a href="#marking-the-packages">Marking the packages</a>
        

        
        </li><li>
        <a href="#testing">Testing</a>
        

        
        </li><li>
        <a href="#correction">Correction</a>
        

        
        </li></ul>
      </li><li>
        <a href="#experiment-2">Experiment 2</a>
        

        
        <ul>
            <li>
        <a href="#marking-packets">Marking packets</a>
        

        
        </li></ul>
      </li><li>
        <a href="#randomazing-traffik-between-two-vpns">Randomazing traffik between two VPNs</a>
        

        
        <ul>
            <li>
        <a href="#routing-1">Routing</a>
        

        
        </li><li>
        <a href="#masqurading-on-vpn-interfaces">Masqurading on VPN interfaces</a>
        

        
        </li><li>
        <a href="#prevent-killing-vpn-connections">Prevent killing VPN connections</a>
        

        
        </li><li>
        <a href="#marking-packets-randomly-only-those-which-start-connections">Marking packets randomly, only those which start connections</a>
        

        
        </li><li>
        <a href="#summary">Summary</a>
        

        
        </li></ul>
      </li><li>
        <a href="#references">References</a>
        </li></ul>
  </details>

    <h2 id="experiment-1">Experiment 1</h2>
<p>We want to send http traffik generated by our computer through a VPN tunnel.</p>
<h3 id="vpn-tunnels">VPN tunnels</h3>
<p>Create two VPN tunnels:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openvpn --config au.ovpn
</span></span><span style="display:flex;"><span>openvpn --config at.ovpn
</span></span></code></pre></div><p>Two new interfaces will be created: <code>tun0</code> and <code>tun1</code>.</p>
<p>Two configs should prevent setting of default gateways:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>pull-filter ignore redirect-gateway
</span></span></code></pre></div><h3 id="routing">Routing</h3>
<p>Create a new routing table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;201 vpn1&#34;</span> &gt;&gt; /etc/iproute2/rt_tables
</span></span></code></pre></div><p>and add default routing to the table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route add default dev tun1 table vpn1
</span></span></code></pre></div><p>Check:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route show table vpn1
</span></span></code></pre></div><p>Now, let&rsquo;s add a rule:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip rule add from all fwmark <span style="color:#bd93f9">1</span> lookup vpn1
</span></span></code></pre></div><p>The rule says that packages with mark 0x1 should be routed using table <code>vpn1</code>. Effectively, that means, the packages will go to <code>tun1</code> interface.</p>
<h3 id="marking-the-packages">Marking the packages</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -p tcp --dport <span style="color:#bd93f9">80</span> -j MARK --set-mark <span style="color:#bd93f9">1</span>
</span></span></code></pre></div><h3 id="testing">Testing</h3>
<p>Let&rsquo;s try to access some site on port 80:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl ipinfo.io
</span></span></code></pre></div><p>The command times out. So what&rsquo;s a problem? The packages are indeed marked with 0x1 and indeed go through <code>tun1</code> but they have as source IP not <code>tun1</code>&rsquo;s IP but IP of <code>eth0</code> on which <code>curl</code> is bound and sends the request. So the packages with SYN flag go through <code>tun1</code> interface but ACK packages from the destination are sent to <code>eth0</code> IP.</p>
<h3 id="correction">Correction</h3>
<p>We should somehow to change source IP of the packages to the IP of <code>tun1</code> and when they are back at <code>tun1</code> we need to send them back to <code>eth0</code> on which <code>curl</code> communicates. But that&rsquo;s exactly what NAT MASQUARADE exists for. So, we set <code>tun1</code> into that mode:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t nat -A POSTROUTING -o tun1 -j MASQUERADE
</span></span></code></pre></div><p>Bingo!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl ipinfo.io
</span></span></code></pre></div><p>works through <code>tun1</code>.</p>
<h2 id="experiment-2">Experiment 2</h2>
<p>Connections from port 4444 send through vpn1</p>
<h3 id="marking-packets">Marking packets</h3>
<p>Remove previous rules on mangle table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -F OUTPUT
</span></span></code></pre></div><p>and set new:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -p tcp --sport <span style="color:#bd93f9">4444</span> -j MARK --set-mark <span style="color:#bd93f9">1</span>
</span></span></code></pre></div><p>Because <code>curl</code> does not allow to specify source port in its <code>--interface</code> option, we&rsquo;ll use <code>nc</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">echo</span> -e <span style="color:#f1fa8c">&#34;GET / HTTP/1.1\r\nHost: ipinfo.io\r\nConnection: close\r\n\r\n&#34;</span> | nc ipinfo.io <span style="color:#bd93f9">80</span> -p <span style="color:#bd93f9">4444</span>
</span></span></code></pre></div><p>Ok, we get through vpn1. If we remove <code>-p 4444</code> command line option, we go through our default interface, not through vpn1.</p>
<p>Note: nat rule on vpn1 is still there. It&rsquo;s a must requirement.</p>
<h2 id="randomazing-traffik-between-two-vpns">Randomazing traffik between two VPNs</h2>
<h3 id="routing-1">Routing</h3>
<p>We create two routing tables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /etc/iproute2/rt_tables
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># reserved values</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span>255	<span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>254	main
</span></span><span style="display:flex;"><span>253	default
</span></span><span style="display:flex;"><span>0	unspec
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># local</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#1	inr.ruhep</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">100</span> custom_table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">200</span> vpn0
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">201</span> vpn1
</span></span></code></pre></div><p>We create default routes in the above  tables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route add default tun1 table vpn1
</span></span><span style="display:flex;"><span>ip route add default tun0 table vpn0
</span></span></code></pre></div><p>Check:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route show table vpn1
</span></span><span style="display:flex;"><span>default dev tun1 scope link 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip route show table vpn0
</span></span><span style="display:flex;"><span>default dev tun0 scope link 
</span></span></code></pre></div><p>We create two rules:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip rule add from all fwmark <span style="color:#bd93f9">2</span> lookup vpn0
</span></span><span style="display:flex;"><span>ip rule add from all fwmark <span style="color:#bd93f9">1</span> lookup vpn1
</span></span></code></pre></div><p>Check:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip rule
</span></span><span style="display:flex;"><span>0:	from all lookup <span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>32760:	from all fwmark 0x2 lookup vpn0
</span></span><span style="display:flex;"><span>32761:	from all fwmark 0x1 lookup vpn1
</span></span><span style="display:flex;"><span>32766:	from all lookup main
</span></span><span style="display:flex;"><span>32767:	from all lookup default
</span></span></code></pre></div><h3 id="masqurading-on-vpn-interfaces">Masqurading on VPN interfaces</h3>
<p>We should activate nat masquarading on both vpns:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE
</span></span><span style="display:flex;"><span>iptables -t nat -A POSTROUTING -o tun1 -j MASQUERADE
</span></span></code></pre></div><h3 id="prevent-killing-vpn-connections">Prevent killing VPN connections</h3>
<p>We are going to put all traffik through VPNs, not only to port 80 or from port 4444. Therefore we need to prevent sending VPN client connections to VPN servers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -d 146.70.116.194 -j RETURN
</span></span><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -d 103.108.231.98 -j RETURN
</span></span></code></pre></div><h3 id="marking-packets-randomly-only-those-which-start-connections">Marking packets randomly, only those which start connections</h3>
<p>The next we want to randomly mark packets. If we just mark <em>ALL</em> packets randomly then we destroy the connection. Suppose, SYN packet was marked 1 and sent to tun1. The reponse with SYN-ACK
was delivered to the sending interface ETH1 from VPN but now, ACK package from ETH1 is marked 2 and send to tun0. Thus connection is never established. It was not a case when we had only one VPN interface and all packets were sent to the same VPN interface.</p>
<p>Therefore, we mark only packets which start a connection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -m conntrack --ctstate NEW -m statistic --mode random --probability 0.5 -j MARK --set-mark <span style="color:#bd93f9">2</span>
</span></span></code></pre></div><p>The above marks 50% of connection starting packets. Then we match non-marked packets which start a connection and mark them with 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -m conntrack --ctstate NEW -m mark --mark <span style="color:#bd93f9">0</span> -j MARK --set-mark <span style="color:#bd93f9">1</span>
</span></span></code></pre></div><p>Now we want to preserve the marks we gave for all the packets in the connection a marked packet started:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -m conntrack --ctstate NEW -j CONNMARK --save-mark
</span></span><span style="display:flex;"><span>iptables -t mangle -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j CONNMARK --restore-mark
</span></span></code></pre></div><p>The above rules save the mark of a new connection and restore that mark for all the packets in the established connection. The same mark in all packets of the connection guarantees all the
packets arrive at the same VPN interface.</p>
<h3 id="summary">Summary</h3>
<p>Masquarade:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t nat -L -v -n
</span></span><span style="display:flex;"><span>Chain PREROUTING <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain INPUT <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain OUTPUT <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain POSTROUTING <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">148</span> <span style="color:#bd93f9">13070</span> MASQUERADE  all  --  *      tun1    0.0.0.0/0            0.0.0.0/0           
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">203</span> <span style="color:#bd93f9">17720</span> MASQUERADE  all  --  *      tun0    0.0.0.0/0            0.0.0.0/0   
</span></span></code></pre></div><p>Mangle:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>iptables -t mangle -L -v -n
</span></span><span style="display:flex;"><span>Chain PREROUTING <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain INPUT <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain FORWARD <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain OUTPUT <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">7839</span> 1001K RETURN     tcp  --  *      *       0.0.0.0/0            146.70.116.194      
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">55156</span> 8718K RETURN     tcp  --  *      *       0.0.0.0/0            103.108.231.98      
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">377</span> <span style="color:#bd93f9">32241</span> MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW statistic mode random probability 0.50000000000 MARK <span style="color:#8be9fd;font-style:italic">set</span> 0x2
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">274</span> <span style="color:#bd93f9">30364</span> MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW mark match 0x0 MARK <span style="color:#8be9fd;font-style:italic">set</span> 0x1
</span></span><span style="display:flex;"><span>  <span style="color:#bd93f9">493</span> <span style="color:#bd93f9">48897</span> CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW CONNMARK save
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">1658</span>  224K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED CONNMARK restore
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Chain POSTROUTING <span style="color:#ff79c6">(</span>policy ACCEPT <span style="color:#bd93f9">0</span> packets, <span style="color:#bd93f9">0</span> bytes<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span> pkts bytes target     prot opt in     out     <span style="color:#8be9fd;font-style:italic">source</span>               destination         
</span></span></code></pre></div><p>Routing tables:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /etc/iproute2/rt_tables
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># reserved values</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span>255	<span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>254	main
</span></span><span style="display:flex;"><span>253	default
</span></span><span style="display:flex;"><span>0	unspec
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># local</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#1	inr.ruhep</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">100</span> custom_table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">200</span> vpn0
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">201</span> vpn1
</span></span></code></pre></div><p>Routing table routes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route show table vpn1
</span></span><span style="display:flex;"><span>default dev tun1 scope link 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip route show table vpn0
</span></span><span style="display:flex;"><span>default dev tun0 scope link 
</span></span></code></pre></div><p>Routing rules:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip rule
</span></span><span style="display:flex;"><span>0:	from all lookup <span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>32760:	from all fwmark 0x2 lookup vpn0
</span></span><span style="display:flex;"><span>32761:	from all fwmark 0x1 lookup vpn1
</span></span><span style="display:flex;"><span>32766:	from all lookup main
</span></span><span style="display:flex;"><span>32767:	from all lookup default
</span></span></code></pre></div><h2 id="references">References</h2>
<ol>
<li><a href="https://datahacker.blog/industry/technology-menu/networking/routes-and-rules/iproute-and-routing-tables" target="_blank" rel="noopener">https://datahacker.blog/industry/technology-menu/networking/routes-and-rules/iproute-and-routing-tables</a>
</li>
<li><a href="https://www.frozentux.net/iptables-tutorial/chunkyhtml/c962.html#TABLE.FORWARDEDPACKETS" target="_blank" rel="noopener">https://www.frozentux.net/iptables-tutorial/chunkyhtml/c962.html#TABLE.FORWARDEDPACKETS</a>
</li>
<li><a href="https://book.huihoo.com/iptables-tutorial/x9125.htm" target="_blank" rel="noopener">https://book.huihoo.com/iptables-tutorial/x9125.htm</a>
</li>
</ol>

  <hr>
  <p class="text-black dark:text-white text-2xl font-bold">Share</p>

  <div class="container p-6 mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-8">
			<a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.ScienceChronicle.org%2fen%2farticle%2fround-robin-load-balancing-between-two-vpns-with-iptables-and-pbr%2f" aria-label="share on Facebook"><img width="64px" src="data:image/png;base64,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" />
</a>
			
			<a href="http://www.twitter.com/share?url=https%3a%2f%2fwww.ScienceChronicle.org%2fen%2farticle%2fround-robin-load-balancing-between-two-vpns-with-iptables-and-pbr%2f&text=Round-robin%20load-balancing%20between%20two%20VPNs%20with%20iptables%20and%20policy-based%20routing&via=" 
				aria-label="share on X"
			><img width="64px" src="data:image/png;base64,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" />
</a>

			
  </div>


  <hr>
  <p class="text-black dark:text-white text-2xl font-bold">Tags</p>

  <div class="container p-6 mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-8">
    
  </div>

<hr>
<p class="text-black dark:text-white text-2xl font-bold">Counters</p>
<div class="container p-6 mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-8">
		
	<a href="https://www.liveinternet.ru/click"
	target="_blank"><img id="licnt2240" width="88" height="31" style="border:0" 
	title="LiveInternet: показано число просмотров и посетителей за 24 часа"
	src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7"
	alt=""/></a><script>(function(d,s){d.getElementById("licnt2240").src=
	"https://counter.yadro.ru/hit?t52.6;r"+escape(d.referrer)+
	((typeof(s)=="undefined")?"":";s"+s.width+"*"+s.height+"*"+
	(s.colorDepth?s.colorDepth:s.pixelDepth))+";u"+escape(d.URL)+
	";h"+escape(d.title.substring(0,150))+";"+Math.random()})
	(document,screen)</script>

	
<script type="text/javascript">
	var sc_project=12959554; 
	var sc_invisible=0; 
	var sc_security="f7a76217"; 
	var scJsHost = "https://";
	document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+
	"statcounter.com/counter/counter.js'></"+"script>");
	</script>
	<noscript><div class="statcounter"><a title="Web Analytics"
	href="https://statcounter.com/" target="_blank"><img class="statcounter"
	src="https://c.statcounter.com/12959554/0/f7a76217/0/" alt="Web Analytics"
	referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
	
		
</div>


</article>
<div class="px-2 mb-2">
  
  <script src="https://giscus.app/client.js"
    data-repo=""
    data-repo-id=""
    data-category=""
    data-category-id=""
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
  
</div>
<div class="bg-blue-100 dark:bg-gray-900">
  <div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Support us</div>
      <p class="opacity-60">Science Chronicle</p>
    </div>

    <ul class="flex justify-center gap-x-3 flex-wrap gap-y-2">
      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://bmc.link/sciencechron"
          target="_blank"
          rel="noopener"
          aria-label="Buy Me A Coffee"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 00-1.322-.238c-.826 0-1.491.284-2.26.613z"/>
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://www.youtube.com/channel/UCETqmbO_XcD6NmlfMQT_uXA"
          target="_blank"
          rel="noopener"
          aria-label="YouTube"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon icon-tabler icon-tabler-brand-youtube"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <circle cx="12" cy="12" r="9" />
            <path d="M10 9l5 3l-5 3z" />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://www.facebook.com/profile.php?id=61555545384714"
          target="_blank"
          rel="noopener"
          aria-label="Facebook"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-facebook" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"></path>
          </svg>
        </a>
      </li>
      

      

      
    </ul>
  </div>
</div>

    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2021 - ScienceChronicle.org · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="https://www.ScienceChronicle.org/js/scripts.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-LCXCFMHZQ7"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LCXCFMHZQ7', { 'anonymize_ip': false });
}
</script>



<script>
  const languageMenuButton = document.querySelector('.language-switcher');
  const languageDropdown = document.querySelector('.language-dropdown');
  languageMenuButton.addEventListener('click', (evt) => {
    evt.preventDefault()
    if (languageDropdown.classList.contains('hidden')) {
      languageDropdown.classList.remove('hidden')
      languageDropdown.classList.add('flex')
    } else {
      languageDropdown.classList.add('hidden');
      languageDropdown.classList.remove('flex');
    }
  })
</script>




<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
